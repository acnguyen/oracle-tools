<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Jan 23, 2014
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20140123" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Oracle Tools - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<script src="js/site.js" type="text/javascript"></script>
                      
        
<link rel="shortcut icon" href="images/oracletools-logo.ico"/>
          
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/coherence-community/oracle-tools/">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Oracle Tools Site</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2014-01-23</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.2.1-SNAPSHOT</li>
                      
                
            
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                <ul class="nav nav-list">
                    <li class="nav-header">Oracle Tools</li>
                                
      <li>
    
                          <a href="../index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                  
      <li>
    
                          <a href="../adoption.html" title="Adoption">
          <i class="none"></i>
        Adoption</a>
            </li>
                  
      <li>
    
                          <a href="../history.html" title="Change History">
          <i class="none"></i>
        Change History</a>
            </li>
                              <li class="nav-header">Recommended Reading</li>
                                
      <li>
    
                          <a href="../core/deferreds.html" title="Deferred References">
          <i class="none"></i>
        Deferred References</a>
            </li>
                  
      <li>
    
                          <a href="../runtime/applications.html" title="Application Management">
          <i class="none"></i>
        Application Management</a>
            </li>
                              <li class="nav-header">Modules</li>
                                
      <li>
    
                          <a href="../core/index.html" title="Core Module">
          <i class="none"></i>
        Core Module</a>
            </li>
                  
      <li>
    
                          <a href="../runtime/index.html" title="Runtime Module">
          <i class="none"></i>
        Runtime Module</a>
            </li>
                  
      <li>
    
                          <a href="../testing-support/index.html" title="Testing Support Module">
          <i class="none"></i>
        Testing Support Module</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Coherence Module</a>
          </li>
                              <li class="nav-header">Development</li>
                                
      <li>
    
                          <a href="../license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                  
      <li>
    
                          <a href="../release-numbers.html" title="Release Numbers">
          <i class="none"></i>
        Release Numbers</a>
            </li>
                  
      <li>
    
                          <a href="../source-code.html" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                  
      <li>
    
                          <a href="../building.html" title="Build Instructions">
          <i class="none"></i>
        Build Instructions</a>
            </li>
                  
      <li>
    
                          <a href="../issue-tracking.html" title="Issue Tracking">
          <i class="none"></i>
        Issue Tracking</a>
            </li>
                  
      <li>
    
                          <a href="../contributions.html" title="Contributions">
          <i class="none"></i>
        Contributions</a>
            </li>
                  
      <li>
    
                          <a href="../logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
            </ul>
                
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h2>The Coherence Module for Oracle Tools</h2>

<h4>The Twenty Second Synopsis</h4>

<p><strong>What?</strong>
The Coherence Module for Oracle Tools allows applications to define, create, monitor
and simply manage <a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based applications, including individual
Cache Servers (both storage enabled and disabled), Proxy Servers, Management Servers together
with entire Coherence Clusters at runtime.</p>

<p>Technically speaking, the Coherence Module for Oracle Tools is an extension of and
leverages the facilities provided by the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a>
to control Coherence-based applications, in much the same way that the
<a href="../runtime/index.html">Runtime Module for Oracle Tools</a> controls regular Java and non-Java-based
applications.</p>

<p><strong>When?</strong>
Use the Coherence Module for Oracle Tools when you need to coordinate multiple
<a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> applications, servers or clusters, especially as part of
distributed application functional and integration tests or when you'd traditionally
make use of Shell/Ant/Maven/Python/Groovy et al scripting or the Java Platform
<code>java.lang.Process</code> class.</p>

<p><strong>Why?</strong>
Programmatically controlling and testing distributed applications can be a complicated,
frustrating and error-prone matter.   While the <code>java.lang.Process</code> and associated classes
provide rudimentary mechanisms to control application processes, like <a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>,
developers typically need to make many assumptions about the underlying operating
system, environment, platforms etc, write defensive code for said platforms or make
extensive use of platform-specific scripting.</p>

<p>The Coherence Module for Oracle Tools removes these requirements and simplifies
this development activity when working with <a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>, making developing
complex tests effortless.</p>

<p><strong>How?</strong>
As this module is an extension to the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a> module, we
highly recommend reading the <a href="../runtime/applications.html">Introduction to Application Management</a>
for core concepts, background information and introductory examples.</p>

<p><strong>Where?</strong>
The Coherence Module for Oracle Tools for is defined by the following Maven coordinates
and Java package:</p>

<ul>
<li>Maven Group Id: <code>com.oracle.tools</code></li>
<li>Maven Artifact Id: <code>oracle-tools-coherence</code></li>
<li>Maven Version: <code>1.2.1-SNAPSHOT</code></li>
<li>Java Package: <code>com.oracle.tools.runtime.coherence</code></li>
</ul>

<p>The Coherence Module for Oracle Tools is distributed as a single jar called:
<code>oracle-tools-coherence-1.2.1-SNAPSHOT.jar</code></p>

<p>Source code for this and other Oracle Tools modules can be found here:
<a href="https://github.com/coherence-community/oracle-tools">https://github.com/coherence-community/oracle-tools</a></p>

<h2>Getting Started</h2>

<p>Like the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a>, the Coherence Module for Oracle Tools
uses the concepts of Schemas, Applications and Builders to define, control and construct
<a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based applications.   The difference however is that the Coherence
Module for Oracle Tools introduces several new Schemas, Applications and Builders, specifically
designed for working with <a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>.</p>

<p>Specifically the Coherence Module for Oracle Tools introduces the following classes:</p>

<p><strong><code>com.oracle.tools.runtime.coherence.ClusterMemberSchema</code></strong>: represents the configuration of a
proposed <a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based application / server.</p>

<p><strong><code>com.oracle.tools.runtime.coherence.ClusterMember</code></strong>: represents a controllable runtime
instance of an <a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based application / server.</p>

<p><strong><code>com.oracle.tools.runtime.coherence.ClusterBuilder</code></strong>: provides a mechanism to build an
entire <a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> cluster, based on a collection of ClusterMemberSchemas.</p>

<p><strong><code>com.oracle.tools.runtime.coherence.Cluster</code></strong>: provides a mechanism to represents and
control a <a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> cluster, including access to individual ClusterMembers.</p>

<h2>Tutorial</h2>

<p>The following sections provide recipes using the Coherence Module for Oracle Tools with
<a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>.</p>

<h4>Creating a Single Coherence Storage Enabled Server</h4>

<p>The following example will create a storage-enabled Coherence Cache Server, using
default configuration.</p>

<pre><code>import com.oracle.tools.runtime.java.JavaApplicationBuilder;
import com.oracle.tools.runtime.java.NativeJavaApplicationBuilder

import com.oracle.tools.runtime.java.container.Container;

import com.oracle.tools.runtime.network.AvailablePortIterator;

import static com.oracle.tools.deferred.DeferredHelper.invoking;
import static com.oracle.tools.deferred.Eventually.assertThat;
import static org.hamcrest.CoreMatchers.is;

...

// acquire a set of available ports on the host
AvailablePortIterator availablePorts = Container.getAvailablePorts();

// define a cluster member
ClusterMemberSchema schema =
    new ClusterMemberSchema()
        .setClusterPort(availablePorts)    //automatically choose an available port!
        .useLocalHostMode()
        .setDiagnosticsEnabled(true);

// establish a Native Java Application Builder to realize the cluster member
// (the realized ClusterMembers will be run as native local processes)
JavaApplicationBuilder&lt;ClusterMember, ClusterMemberSchema&gt; builder =
    new NativeJavaApplicationBuilder&lt;&gt;();

// the cluster member
ClusterMember member  = null;

try
{
    // realize the cluster member (as a native process)
    member = builder.realize(schema, "TEST");

    // assert that (eventually) the cluster details are as expected
    Eventually.assertThat(invoking(member).getLocalMemberId(), is(1));
    Eventually.assertThat(invoking(member).getClusterSize(), is(1));
}
finally
{
    if (member != null)
    {
        member.destroy();
    }
}
</code></pre>

<p>Important concepts from the above example:</p>

<h5>AvailablePortIterators:</h5>

<p><code>AvailablePortIterator</code>s free developers from working out available server socket
ports on a host.   All port-based parameters for <code>ClusterMemberSchema</code> naturally accept
either a specific port or an <code>AvailablePortIterator</code>.   By using <code>AvailablePortIterator</code>s
it's highly unlikely you'll ever have to set a Coherence cluster port.</p>

<p>To determine the port that is actually used for a <code>ClusterMember</code>, simply use the
<code>ClusterMember.getClusterPort()</code> method.</p>

<h5>Use Local Host Mode:</h5>

<p>The <code>useLocalHostMode</code> property of a <code>ClusterMemberSchema</code> automatically sets the
<code>ClusterMember</code> to use a TTL of 0 and binds the localhost to a suitable localhost address.</p>

<p>Using "useLocalHostMode" eliminates the need to determine the cluster address on which
a <code>ClusterMember</code> should listen.   The downside being, that only <code>ClusterMember</code>s on the
said host will cluster together, and not across hosts.</p>

<h5>Java Application Builders:</h5>

<p>As introduced by the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a>, the Coherence Module
for Oracle Tools uses Java Application Builders in order to realize and construct
Cluster Members (and Clusters.</p>

<p>In this example we have used a <code>NativeJavaApplicationBuilder</code>, but we could have also
used a <code>ContainerBasedJavaApplicationBuilder</code> to realize and run the <code>ClusterMember</code>
isolated with in the same Java Virtual Machine as the example itself!</p>

<h5>Diagnostics:</h5>

<p>When a <code>ClusterMemberSchema</code> has <code>setDiagnosticsEnabled</code>, all output from applications
ie: <code>ClusterMembers</code>, created using the said schema will be redirected to the standard
console.   This is irrespective of any additional console that is specified as part
of realizing an application using a builder.</p>

<p>Should diagnostics be disabled (the default) and no console is specified for a builder
when realizing an application, no output from the said application will be produced
(it essentially all goes to /dev/null).</p>

<h5>Eventually.assertThat(...):</h5>

<p>The use of the <code>Eventually</code> class, together with Deferred References, allows developers
to write test cases and asserts on asynchronous tasks without requiring <code>Thread.sleep(...)</code>
calls being placed in application code.</p>

<h5>ClusterMemberSchema:</h5>

<p>The <code>ClusterMemberSchema</code> class provides all of the typically used <a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>
properties that an application developer would set, including those at the command-line.</p>

<p>Some of the available options include:</p>

<pre><code>setCacheConfigURI(String)
setOperationalOverrideURI(String)

setPofConfigURI(String)
setPofEnabled(boolean)

setStorageEnabled(boolean)

setLocalHostAddress(String)
setLocalHostPort(int)

setWellKnownAddress(String)
setWellKnownAddressPort(int)

setTCMPEnabled(boolean)

setMulticastTTL(int)

setClusterPort(int)
setClusterPort(Iterator&lt;Integer&gt; ports)

useLocalHostMode()

setClusterName(string)
setRoleName(String)
setSiteName(String)

setJMXManagementMode(JMXManagementMode)
setRemoteJMXManagement(boolean)

setLogLevel(int)
setLog(String)
</code></pre>

<p>For the complete list of available options, please consult the Java Doc for the
<code>ClusterMemberSchema</code> class.</p>

<h4>Creating a Single Coherence Storage Disabled Server</h4>

<p>Creating a storage-disabled Cluster Member is as simple as setting the <code>setStorageEnabled</code>
property of a <code>ClusterMemberSchema</code> to <code>false</code>.</p>

<pre><code>// define a cluster member
ClusterMemberSchema schema =
    new ClusterMemberSchema()
        .setClusterPort(availablePorts)
        .useLocalHostMode()
        .setStorageEnabled(false)          //storage disabled!
        .setDiagnosticsEnabled(true);
</code></pre>

<h4>Creating a Cluster of Coherence Storage Enabled Servers</h4>

<p>While creating individual <code>ClusterMember</code>s is useful, typically applications and
integration tests require multiple cluster members, arranged as a Coherence Cluster.</p>

<p>To simplify representing, building and managing multiple <code>ClusterMember</code>s as a
group of applications, ie: a <code>Cluster</code>, developers should use the <code>ClusterBuilder</code>.</p>

<pre><code>import com.oracle.tools.runtime.console.SystemApplicationConsole;

import com.oracle.tools.runtime.java.JavaApplicationBuilder;
import com.oracle.tools.runtime.java.NativeJavaApplicationBuilder;

import com.oracle.tools.runtime.java.container.Container;

import com.oracle.tools.runtime.network.AvailablePortIterator;

import static com.oracle.tools.deferred.DeferredHelper.invoking;

import static com.oracle.tools.deferred.Eventually.assertThat;

import static org.hamcrest.CoreMatchers.is;

...

// the desired cluster size
final int CLUSTER_SIZE   = 3;

AvailablePortIterator availablePorts = Container.getAvailablePorts();

// use a Capture to capture the Cluster Port when the first one
// is chosen to ensure that all ClusterMembers use the same port!
Capture&lt;Integer&gt; clusterPort = new Capture&lt;Integer&gt;(availablePorts);

// define the schema for an individual ClusterMember
ClusterMemberSchema  schema = new ClusterMemberSchema()
    .setClusterPort(clusterPort)
    .useLocalHostMode();

// the cluster
Cluster cluster = null;

// establish a Native Java Application Builder to realize the ClusterMembers
JavaApplicationBuilder&lt;ClusterMember, ClusterMemberSchema&gt; memberBuilder =
    new NativeJavaApplicationBuilder&lt;&gt;();

try
{
    // configure our ClusterBuilder
    ClusterBuilder clusterBuilder = new ClusterBuilder();

    // instruct the ClusterBuilder how ClusterMembers will be built
    // (ClusterBuilder may have many different builders!  We're using just one here)
    clusterBuilder.addBuilder(memberBuilder, schema, "CacheServer", CLUSTER_SIZE);

    // realize the cluster
    // (all output from all ClusterMembers in the Cluster will be
    //  redirected to the System Console)
    cluster = clusterBuilder.realize(new SystemApplicationConsole());

    // ensure that the expected cluster is created
    Eventually.assertThat(invoking(cluster).getClusterSize(), is(CLUSTER_SIZE));
}
catch (Exception e)
{
    e.printStackTrace();
    Assert.fail();
}
finally
{
    if (cluster != null)
    {
        // destroys and shuts down the entire cluster
        cluster.destroy();
    }
}
</code></pre>

<p>As mentioned in the above comments, a <code>ClusterBuilder</code> may in fact have multiple ClusterMember
builders associated with it.   This allows different topologies to be constructed.</p>

<p>For example, say you have multiple <code>ClusterSchema</code> definitions, each of which should have a certain
number of members in a cluster.   Using a <code>ClusterBuilder</code> to define this is as easy as:</p>

<pre><code>    clusterBuilder.addBuilder(memberBuilder, storageSchema, "Storage", nrStorageMembers);
    clusterBuilder.addBuilder(memberBuilder, proxySchema, "Proxy", nrProxyMembers);
    clusterBuilder.addBuilder(memberBuilder, managementSchema, "Management", nrManagementMembers);
</code></pre>

<p>When the <code>ClusterBuilder.realize(...)</code> method is called, an entire cluster consisting of the appropriate
number of members will be built and returned as a <code>Cluster</code>.</p>

<p>Furthermore, each of the <code>ClusterMember</code> builders may in fact be different.  For example, you may wish
to establish some <code>ClusterMember</code>s using a <code>ContainerBasedJavaApplicationBuilder</code> and others with
a <code>NativeJavaApplicationBuilder</code>.</p>

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2014.
          All Rights Reserved.      
            
      </div>

                                                                  <?xml version="1.0" encoding="UTF-8"?>
<div class="copyright">Copyright © 2008-2013 Oracle Corporation. All rights reserved.</div>
                                                          <?xml version="1.0" encoding="UTF-8"?>
<div class="version">Version 1.2.1-SNAPSHOT: 2014-01-23 08:25</div>
                  
        
                </div>
    </footer>
  </body>
</html>

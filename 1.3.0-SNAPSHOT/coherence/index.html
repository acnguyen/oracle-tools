<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-05-08 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20140508" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Oracle Tools - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<script src="js/site.js" type="text/javascript"></script>
                      
        
<link rel="shortcut icon" href="images/oracletools-logo.ico"/>
          
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/coherence-community/oracle-tools/">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Oracle Tools Site</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-05-08
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.3.0-SNAPSHOT
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Oracle Tools</li>
                              
      <li>
  
                          <a href="../index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                
      <li>
  
                          <a href="../adoption.html" title="Adoption">
          <i class="none"></i>
        Adoption</a>
            </li>
                
      <li>
  
                          <a href="../history.html" title="Change History">
          <i class="none"></i>
        Change History</a>
            </li>
                              <li class="nav-header">Recommended Reading</li>
                              
      <li>
  
                          <a href="../core/deferreds.html" title="Deferred References">
          <i class="none"></i>
        Deferred References</a>
            </li>
                
      <li>
  
                          <a href="../runtime/applications.html" title="Application Management">
          <i class="none"></i>
        Application Management</a>
            </li>
                              <li class="nav-header">Modules</li>
                              
      <li>
  
                          <a href="../core/index.html" title="Core Module">
          <i class="none"></i>
        Core Module</a>
            </li>
                
      <li>
  
                          <a href="../runtime/index.html" title="Runtime Module">
          <i class="none"></i>
        Runtime Module</a>
            </li>
                
      <li>
  
                          <a href="../testing-support/index.html" title="Testing Support Module">
          <i class="none"></i>
        Testing Support Module</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Coherence Module</a>
          </li>
                              <li class="nav-header">Development</li>
                              
      <li>
  
                          <a href="../license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                
      <li>
  
                          <a href="../release-numbers.html" title="Release Numbers">
          <i class="none"></i>
        Release Numbers</a>
            </li>
                
      <li>
  
                          <a href="../source-code.html" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                
      <li>
  
                          <a href="../building.html" title="Build Instructions">
          <i class="none"></i>
        Build Instructions</a>
            </li>
                
      <li>
  
                          <a href="../issue-tracking.html" title="Issue Tracking">
          <i class="none"></i>
        Issue Tracking</a>
            </li>
                
      <li>
  
                          <a href="../contributions.html" title="Contributions">
          <i class="none"></i>
        Contributions</a>
            </li>
                
      <li>
  
                          <a href="../logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section">
<h2>The Coherence Module for Oracle Tools<a name="The_Coherence_Module_for_Oracle_Tools"></a></h2>

<div class="section">
<div class="section">
<h4>The Twenty Second Synopsis<a name="The_Twenty_Second_Synopsis"></a></h4>
<p><b>What?</b> The Coherence Module for Oracle Tools allows applications to define, create, monitor and simply manage <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based applications, including individual Cache Servers (both storage enabled and disabled), Proxy Servers, Management Servers together with entire Coherence Clusters at runtime.</p>
<p>Technically speaking, the Coherence Module for Oracle Tools is an extension of and leverages the facilities provided by the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a> to control Coherence-based applications, in much the same way that the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a> controls regular Java and non-Java-based applications.</p>
<p><b>When?</b> Use the Coherence Module for Oracle Tools when you need to coordinate multiple <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> applications, servers or clusters, especially as part of distributed application functional and integration tests or when you&#x2019;d traditionally make use of Shell/Ant/Maven/Python/Groovy et al scripting or the Java Platform <tt>java.lang.Process</tt> class.</p>
<p><b>Why?</b> Programmatically controlling and testing distributed applications can be a complicated, frustrating and error-prone matter. While the <tt>java.lang.Process</tt> and associated classes provide rudimentary mechanisms to control application processes, like <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>, developers typically need to make many assumptions about the underlying operating system, environment, platforms etc, write defensive code for said platforms or make extensive use of platform-specific scripting.</p>
<p>The Coherence Module for Oracle Tools removes these requirements and simplifies this development activity when working with <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>, making developing complex tests effortless.</p>
<p><b>How?</b> As this module is an extension to the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a> module, we highly recommend reading the <a href="../runtime/applications.html">Introduction to Application Management</a> for core concepts, background information and introductory examples.</p>
<hr />
</div>
<div class="section">
<h4>Distribution<a name="Distribution"></a></h4>
<p>The Oracle Tools Coherence module is distributed as a single jar called: <tt>oracle-tools-coherence-1.3.0-SNAPSHOT.jar</tt></p>
<p>The <a class="externalLink" href="https://maven.java.net">maven.java.net</a> artifact information is as follows:</p>

<ul>
  
<li>Maven Group Id: <tt>com.oracle.tools</tt></li>
  
<li>Maven Artifact Id: <tt>oracle-tools-coherence</tt></li>
  
<li>Maven Version: <tt>1.3.0-SNAPSHOT</tt></li>
</ul>
<p>Alternatively you can downlown directly from: <img src="../images/external-link.png" alt="External Link" height="10" width="10" align="top" /> <a class="externalLink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=snapshots&amp;g=com.oracle.tools&amp;a=oracle-tools-coherence&amp;v=1.3.0-SNAPSHOT&amp;e=jar">oracle-tools-coherence-1.3.0-SNAPSHOT.jar</a></p>
</div>
<div class="section">
<h4>Source Code<a name="Source_Code"></a></h4>
<p>Source code for this and other Oracle Tools modules can be found here: <a class="externalLink" href="https://github.com/coherence-community/oracle-tools">https://github.com/coherence-community/oracle-tools</a></p></div></div></div>
<div class="section">
<h2>Getting Started<a name="Getting_Started"></a></h2>
<p>Like the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a>, the Coherence Module for Oracle Tools uses the concepts of Schemas, Applications and Builders to define, control and construct <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based applications. The difference however is that the Coherence Module for Oracle Tools introduces several new Schemas, Applications and Builders, specifically designed for working with <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>.</p>
<p>Specifically the Coherence Module for Oracle Tools introduces the following classes:</p>
<p><b><tt>com.oracle.tools.runtime.coherence.ClusterMemberSchema</tt></b>: represents the configuration of a proposed <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based application / server.</p>
<p><b><tt>com.oracle.tools.runtime.coherence.ClusterMember</tt></b>: represents a controllable runtime instance of an <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based application / server.</p>
<p><b><tt>com.oracle.tools.runtime.coherence.ClusterBuilder</tt></b>: provides a mechanism to build an entire <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> cluster, based on a collection of ClusterMemberSchemas.</p>
<p><b><tt>com.oracle.tools.runtime.coherence.Cluster</tt></b>: provides a mechanism to represents and control a <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> cluster, including access to individual ClusterMembers.</p></div>
<div class="section">
<h2>Tutorial<a name="Tutorial"></a></h2>
<p>The following sections provide recipes using the Coherence Module for Oracle Tools with <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>.</p>

<div class="section">
<div class="section">
<h4>Creating a Single Coherence Storage Enabled Server<a name="Creating_a_Single_Coherence_Storage_Enabled_Server"></a></h4>
<p>The following example will create a storage-enabled Coherence Cache Server, using default configuration.</p>

<div class="source">
<pre>import com.oracle.tools.runtime.java.JavaApplicationBuilder;
import com.oracle.tools.runtime.java.NativeJavaApplicationBuilder
import com.oracle.tools.runtime.java.container.Container;
import com.oracle.tools.runtime.network.AvailablePortIterator;
import static com.oracle.tools.deferred.DeferredHelper.invoking;
import static com.oracle.tools.deferred.Eventually.assertThat;
import static org.hamcrest.CoreMatchers.is;

...

// acquire a set of available ports on the host
AvailablePortIterator availablePorts = Container.getAvailablePorts();

// define a cluster member
ClusterMemberSchema schema =
    new ClusterMemberSchema()
        .setClusterPort(availablePorts)    //automatically choose an available port!
        .useLocalHostMode()
        .setDiagnosticsEnabled(true);

// establish a Native Java Application Builder to realize the cluster member
// (the realized ClusterMembers will be run as native local processes)
JavaApplicationBuilder&lt;ClusterMember, ClusterMemberSchema&gt; builder =
    new NativeJavaApplicationBuilder&lt;&gt;();

// the cluster member
ClusterMember member  = null;

try
{
    // realize the cluster member (as a native process)
    member = builder.realize(schema, &quot;TEST&quot;);

    // assert that (eventually) the cluster details are as expected
    Eventually.assertThat(invoking(member).getLocalMemberId(), is(1));
    Eventually.assertThat(invoking(member).getClusterSize(), is(1));
}
finally
{
    if (member != null)
    {
        member.destroy();
    }
}
</pre></div>
<p>Important concepts from the above example:</p>

<div class="section">
<h5>AvailablePortIterators:<a name="AvailablePortIterators:"></a></h5>
<p><tt>AvailablePortIterator</tt>s free developers from working out available server socket ports on a host. All port-based parameters for <tt>ClusterMemberSchema</tt> naturally accept either a specific port or an <tt>AvailablePortIterator</tt>. By using <tt>AvailablePortIterator</tt>s it&#x2019;s highly unlikely you&#x2019;ll ever have to set a Coherence cluster port.</p>
<p>To determine the port that is actually used for a <tt>ClusterMember</tt>, simply use the <tt>ClusterMember.getClusterPort()</tt> method.</p>
</div>
<div class="section">
<h5>Use Local Host Mode:<a name="Use_Local_Host_Mode:"></a></h5>
<p>The <tt>useLocalHostMode</tt> property of a <tt>ClusterMemberSchema</tt> automatically sets the <tt>ClusterMember</tt> to use a TTL of 0 and binds the localhost to a suitable localhost address.</p>
<p>Using &#x201c;useLocalHostMode&#x201d; eliminates the need to determine the cluster address on which a <tt>ClusterMember</tt> should listen. The downside being, that only <tt>ClusterMember</tt>s on the said host will cluster together, and not across hosts.</p>
</div>
<div class="section">
<h5>Java Application Builders:<a name="Java_Application_Builders:"></a></h5>
<p>As introduced by the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a>, the Coherence Module for Oracle Tools uses Java Application Builders in order to realize and construct Cluster Members (and Clusters.</p>
<p>In this example we have used a <tt>NativeJavaApplicationBuilder</tt>, but we could have also used a <tt>ContainerBasedJavaApplicationBuilder</tt> to realize and run the <tt>ClusterMember</tt> isolated with in the same Java Virtual Machine as the example itself!</p>
</div>
<div class="section">
<h5>Diagnostics:<a name="Diagnostics:"></a></h5>
<p>When a <tt>ClusterMemberSchema</tt> has <tt>setDiagnosticsEnabled</tt>, all output from applications ie: <tt>ClusterMembers</tt>, created using the said schema will be redirected to the standard console. This is irrespective of any additional console that is specified as part of realizing an application using a builder.</p>
<p>Should diagnostics be disabled (the default) and no console is specified for a builder when realizing an application, no output from the said application will be produced (it essentially all goes to /dev/null).</p>
</div>
<div class="section">
<h5>Eventually.assertThat(...):<a name="Eventually.assertThat...:"></a></h5>
<p>The use of the <tt>Eventually</tt> class, together with Deferred References, allows developers to write test cases and asserts on asynchronous tasks without requiring <tt>Thread.sleep(...)</tt> calls being placed in application code.</p>
</div>
<div class="section">
<h5>ClusterMemberSchema:<a name="ClusterMemberSchema:"></a></h5>
<p>The <tt>ClusterMemberSchema</tt> class provides all of the typically used <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> properties that an application developer would set, including those at the command-line.</p>
<p>Some of the available options include:</p>

<div class="source">
<pre>setCacheConfigURI(String)
setOperationalOverrideURI(String)

setPofConfigURI(String)
setPofEnabled(boolean)

setStorageEnabled(boolean)

setLocalHostAddress(String)
setLocalHostPort(int)

setWellKnownAddress(String)
setWellKnownAddressPort(int)

setTCMPEnabled(boolean)

setMulticastTTL(int)

setClusterPort(int)
setClusterPort(Iterator&lt;Integer&gt; ports)

useLocalHostMode()

setClusterName(string)
setRoleName(String)
setSiteName(String)

setJMXManagementMode(JMXManagementMode)
setRemoteJMXManagement(boolean)

setLogLevel(int)
setLog(String)
</pre></div>
<p>For the complete list of available options, please consult the Java Doc for the <tt>ClusterMemberSchema</tt> class.</p>
</div></div>
<div class="section">
<h4>Creating a Single Coherence Storage Disabled Server<a name="Creating_a_Single_Coherence_Storage_Disabled_Server"></a></h4>
<p>Creating a storage-disabled Cluster Member is as simple as setting the <tt>setStorageEnabled</tt> property of a <tt>ClusterMemberSchema</tt> to <tt>false</tt>.</p>

<div class="source">
<pre>// define a cluster member
ClusterMemberSchema schema =
    new ClusterMemberSchema()
        .setClusterPort(availablePorts)
        .useLocalHostMode()
        .setStorageEnabled(false)          //storage disabled!
        .setDiagnosticsEnabled(true);
</pre></div>
</div>
<div class="section">
<h4>Creating a Cluster of Coherence Storage Enabled Servers<a name="Creating_a_Cluster_of_Coherence_Storage_Enabled_Servers"></a></h4>
<p>While creating individual <tt>ClusterMember</tt>s is useful, typically applications and integration tests require multiple cluster members, arranged as a Coherence Cluster.</p>
<p>To simplify representing, building and managing multiple <tt>ClusterMember</tt>s as a group of applications, ie: a <tt>Cluster</tt>, developers should use the <tt>ClusterBuilder</tt>.</p>

<div class="source">
<pre>import com.oracle.tools.runtime.console.SystemApplicationConsole;
import com.oracle.tools.runtime.java.JavaApplicationBuilder;
import com.oracle.tools.runtime.java.NativeJavaApplicationBuilder;
import com.oracle.tools.runtime.java.container.Container;
import com.oracle.tools.runtime.network.AvailablePortIterator;
import static com.oracle.tools.deferred.DeferredHelper.invoking;
import static com.oracle.tools.deferred.Eventually.assertThat;
import static org.hamcrest.CoreMatchers.is;

...

// the desired cluster size
final int CLUSTER_SIZE   = 3;

AvailablePortIterator availablePorts = Container.getAvailablePorts();

// use a Capture to capture the Cluster Port when the first one
// is chosen to ensure that all ClusterMembers use the same port!
Capture&lt;Integer&gt; clusterPort = new Capture&lt;Integer&gt;(availablePorts);

// define the schema for an individual ClusterMember
ClusterMemberSchema  schema = new ClusterMemberSchema()
    .setClusterPort(clusterPort)
    .useLocalHostMode();

// the cluster
Cluster cluster = null;

// establish a Native Java Application Builder to realize the ClusterMembers
JavaApplicationBuilder&lt;ClusterMember, ClusterMemberSchema&gt; memberBuilder =
    new NativeJavaApplicationBuilder&lt;&gt;();

try
{
    // configure our ClusterBuilder
    ClusterBuilder clusterBuilder = new ClusterBuilder();

    // instruct the ClusterBuilder how ClusterMembers will be built
    // (ClusterBuilder may have many different builders!  We're using just one here)
    clusterBuilder.addBuilder(memberBuilder, schema, &quot;CacheServer&quot;, CLUSTER_SIZE);

    // realize the cluster
    // (all output from all ClusterMembers in the Cluster will be
    //  redirected to the System Console)
    cluster = clusterBuilder.realize(new SystemApplicationConsole());

    // ensure that the expected cluster is created
    Eventually.assertThat(invoking(cluster).getClusterSize(), is(CLUSTER_SIZE));
}
catch (Exception e)
{
    e.printStackTrace();
    Assert.fail();
}
finally
{
    if (cluster != null)
    {
        // closes and shutsdown the cluster
        cluster.close();
    }
}
</pre></div>
<p>As mentioned in the above comments, a <tt>ClusterBuilder</tt> may in fact have multiple ClusterMember builders associated with it. This allows different topologies to be constructed.</p>
<p>For example, say you have multiple <tt>ClusterSchema</tt> definitions, each of which should have a certain number of members in a cluster. Using a <tt>ClusterBuilder</tt> to define this is as easy as:</p>

<div class="source">
<pre>clusterBuilder.addBuilder(memberBuilder, storageSchema, &quot;Storage&quot;, nrStorageMembers);
clusterBuilder.addBuilder(memberBuilder, proxySchema, &quot;Proxy&quot;, nrProxyMembers);
clusterBuilder.addBuilder(memberBuilder, managementSchema, &quot;Management&quot;, nrManagementMembers);
</pre></div>
<p>When the <tt>ClusterBuilder.realize(...)</tt> method is called, an entire cluster consisting of the appropriate number of members will be built and returned as a <tt>Cluster</tt>.</p>
<p>Furthermore, each of the <tt>ClusterMember</tt> builders may in fact be different. For example, you may wish to establish some <tt>ClusterMember</tt>s using a <tt>ContainerBasedJavaApplicationBuilder</tt> and others with a <tt>NativeJavaApplicationBuilder</tt>.</p></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                   2014.
          All rights reserved.      
                    
      </p>
        </div>

                                                                  
<div class="copyright">Copyright © 2008-2013 Oracle Corporation. All rights reserved.</div>
                                                          
<div class="version">Version 1.3.0-SNAPSHOT: 2014-05-08 20:28</div>
                  
        
                </div>
    </footer>
        </body>
</html>
